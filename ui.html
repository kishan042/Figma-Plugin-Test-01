<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Figma Layout</title>
<style>
body {
  font-family: Inter, sans-serif;
  font-size: 13px;
  color: #222;
  margin: 0;
  padding: 12px;
  background: #fff;
  overflow: hidden; /* Prevent vertical overscrolling */
  box-sizing: border-box;
}
.container {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 12px;
  width: 100%;
  max-width: 200px; /* Ensure proper width fitting */
  box-sizing: border-box;
}
header {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
}
.setting {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
.switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 20px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .2s;
  border-radius: 20px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 14px;
  width: 14px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .2s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4c6ef5;
}
input:checked + .slider:before {
  transform: translateX(14px);
}
button.primary {
  width: 100%;
  padding: 6px;
  background-color: #4c6ef5;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  transition: background-color .2s;
}
button.primary:active {
  background-color: #364fc7;
}
</style>
</head>
<body>
<div class="container">
  <header>Figma Layout</header>
  <div id="collectionsContainer">
    <p id="noSelection" style="color: #999; font-size: 12px;">Select a frame to detect collections</p>
  </div>
  <button id="createButton" class="primary" disabled>Create</button>
</div>
<script>
let detectedCollections = [];

// Listen for messages from plugin
window.onmessage = (event) => {
  const msg = event.data.pluginMessage;
  
  if (msg.type === 'NO_SELECTION') {
    showNoSelection();
  } else if (msg.type === 'COLLECTIONS_DETECTED') {
    showCollections(msg.collections);
  }
};

function showNoSelection() {
  const container = document.getElementById('collectionsContainer');
  container.innerHTML = '<p id="noSelection" style="color: #999; font-size: 12px;">Select a frame to detect collections</p>';
  document.getElementById('createButton').disabled = true;
  detectedCollections = [];
}

function showCollections(collections) {
  detectedCollections = collections;
  const container = document.getElementById('collectionsContainer');
  
  if (collections.length === 0) {
    container.innerHTML = '<p style="color: #999; font-size: 12px;">No variable collections detected in selection</p>';
    document.getElementById('createButton').disabled = true;
    return;
  }
  
  container.innerHTML = '';
  collections.forEach((collection, index) => {
    const setting = document.createElement('div');
    setting.className = 'setting';
    setting.innerHTML = `
      <label for="toggle${index}">${collection.name}</label>
      <label class="switch">
        <input type="checkbox" id="toggle${index}" data-collection-id="${collection.id}" />
        <span class="slider"></span>
      </label>
    `;
    container.appendChild(setting);
  });
  
  document.getElementById('createButton').disabled = false;
}

function sendCreate() {
  const enabledCollections = [];
  
  detectedCollections.forEach((collection, index) => {
    const toggle = document.getElementById(`toggle${index}`);
    if (toggle && toggle.checked) {
      enabledCollections.push(collection);
    }
  });
  
  if (enabledCollections.length === 0) {
    return; // Button click won't do anything if no toggles are on
  }
  
  parent.postMessage({ 
    pluginMessage: { 
      type: 'CREATE', 
      collections: enabledCollections 
    } 
  }, '*');
}

document.getElementById('createButton').addEventListener('click', sendCreate);
</script>
</body>
</html>
